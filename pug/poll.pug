//- Source file for a poll page is rendered based on the following:
//- 1. If a user is authenticated, adds "Add Option" button
//- 2. If a user is the poll creator, add a Delete Button as well

include mixins.pug

html
  head
    meta(http-equiv="content-type" content="text/html; charset=utf-8")

    title= pollName

    script(src="https://d3js.org/d3.v4.min.js")
    script(src="/common/gen_chart.js")

    +styleSheets()

  body

    +topMenu("poll")
    +appTitle()

    div.container
      div.row
        div.col-md-1

        //- This part handles data input from users
        div.col-md-5.poll-page-box
          h1= pollName

          - if (isCreator)
            form(method="GET" action="/polls/delete/" + pollID)
              button.btn.btn-delete.btn-danger(type="submit") Delete Poll

          //- Generate voting options for the user.
          div.voting-radio-buttons
            form(method="POST" action="/polls/vote/" + pollID)
              - for (var i = 0; i < options.length; i++) {
                div.form-group
                  label= options[i]
                  input(type="radio" name="option" value="" + options[i])
              -}
              button.btn.btn-clem(type="submit") Vote!


          - if (isAuth)
            p As a registered user, feel free to create a new voting option:
            form(method="POST" action="/polls/update/" + pollID)
              input.form-control#optionField(
              name="option" type="text" placeholder="Option" pattern="^[^<>/]+$")
              button.btn.btn-clem(type="submit") Add Option

        //- This part shows the poll results as a chart
        div.col-md-5.poll-page-box#poll-chart
          - if(0) {
            p Chart of the poll data should be shown here
            p Show poll results here
            ul
              - for (var i = 0; i < options.length; i++) {
                li= options[i] + ": " + votes[i]
              -}
          -}
        div.col-md-1

    +appFooter()

    script(type="text/javascript" src="/common/ajax-functions.js")
    script(type="text/javascript" src="/controllers/pollController.client.js")

